import { Column, Entity, JoinColumn, ManyToOne, OneToMany, PrimaryGeneratedColumn } from 'typeorm';
import { RecordDto, VulnerabilityDto } from './vulnerability.dto';

@Entity()
export class Vulnerability implements VulnerabilityDto {
    @PrimaryGeneratedColumn('uuid')
    id: string;

    @Column({length: 256})
    name: string;

    @Column('text')
    description: string;

    @OneToMany(
        (type) => Record, (record) => record.vulnerabilityId,
        {cascade: true, onDelete: 'CASCADE', primary: true}
    )
    @JoinColumn({ name: 'records', referencedColumnName: 'name'})
    records: Record[];
}

@Entity()
export class Record implements RecordDto {
    @PrimaryGeneratedColumn('uuid')
    id: string;

    @Column({length: 256})
    name: string;

    @ManyToOne((type) => Vulnerability, (vulnerability) => vulnerability.records)
    vulnerabilityId: string[];
}
